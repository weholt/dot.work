---
# Repository Configuration
repo_url: "https://github.com/your-user/your-repo.git"
base_branch: "main"                 # Base branch to create feature branch from
branch: "auto/refactor-{{timestamp}}"  # Feature branch name (use {{timestamp}} for uniqueness)

# Docker Configuration
docker_image: "repo-agent:latest"   # Use repo-agent:node for Node tools, repo-agent:alpine for minimal
# dockerfile: "../Dockerfile"       # Optional: path to custom Dockerfile to build before running

# Authentication
use_ssh: false                      # Set true to use SSH keys instead of HTTPS token
# ssh_key_dir: "~/.ssh"             # Custom SSH key directory (defaults to ~/.ssh)
github_token_env: "GITHUB_TOKEN"    # Environment variable containing GitHub token

# Model and Strategy
# LLM Configuration
model: "openai/gpt-4"  # Format: "provider/model-name"
# For OpenRouter or other providers that need API keys:
# api_key_env: "OPENROUTER_API_KEY"  # Reads from $env:OPENROUTER_API_KEY
strategy: "agentic"                 # "agentic" = autonomous planning, "direct" = minimal edits

# Tool Configuration (fully configurable - not limited to OpenCode)
tool:
  name: "opencode"                  # Tool identifier
  entrypoint: "opencode run"        # Command to execute (can be any CLI tool)
  args:
    # Tool-specific arguments - these become CLI flags
    # Example: the below becomes: --strategy agentic --commit false
    strategy: "agentic"
    commit: false

  # Custom prompt headers for different strategies
  prompt_header_agentic: |
    You are an autonomous coding agent working on this repository.
    Plan your approach carefully, considering:
    - Code structure and architecture
    - Backward compatibility
    - Test coverage
    - Documentation updates
    Then execute the necessary edits to implement the requested changes,
    keeping commits logical and cohesive.

  prompt_header_direct: |
    Apply the following changes directly to this repository.
    Make minimal, focused edits and keep the diff small and coherent.
    Avoid unnecessary refactoring or changes outside the scope.

# Git and Pull Request Configuration
git_user_name: "Repo Agent"
git_user_email: "repo-agent@example.com"
auto_commit: true                   # Automatically commit and push changes
create_pr: true                     # Create a pull request after pushing
create_repo_if_missing: false       # Auto-create repository if it doesn't exist (requires repo scope token)
commit_message: "chore: automated refactor via repo-agent"
pr_title: "ðŸ¤– Automated Code Refactoring"
pr_body: |
  This PR was generated automatically by **repo-agent** using AI-powered code tools.

  ## Summary
  - â™»ï¸ Refactors targeted code paths for better readability
  - ðŸ·ï¸ Improves type hints and type safety
  - ðŸ“ Updates documentation where appropriate
  - âœ… Maintains backward compatibility
  - ðŸ§ª Ensures all tests continue to pass

  ## Tool Used
  - **Model**: openai/gpt-4o-mini
  - **Strategy**: agentic
  - **Tool**: opencode

  ---
  _Generated by [repo-agent](https://github.com/your-org/repo-agent)_
---

# Instructions

## Objective

Refactor the existing codebase to improve maintainability, type safety, and documentation quality.

## Tasks

### 1. Code Structure and Readability

- Extract overly long functions (>50 lines) into smaller, focused functions with clear single responsibilities
- Identify and eliminate code duplication using DRY principles
- Improve naming conventions for better self-documentation
- Keep all public APIs backward compatible (no breaking changes)
- Add docstrings to public functions and classes that are missing them

### 2. Type Safety

- Add or improve type hints where they are missing or incomplete
- Use proper generic types where applicable (`list[str]` instead of `list`, etc.)
- Add basic validation for function inputs where it improves safety
- Ensure type hints are compatible with Python 3.11+

### 3. Documentation

- Update README.md to reflect any architectural changes
- Add inline comments for complex logic
- Ensure docstrings follow a consistent format (Google or NumPy style)
- Update any outdated examples or usage instructions

### 4. Testing

- Run the existing test suite and ensure all tests pass
- Add small, focused unit tests for any newly extracted functions
- If obvious edge cases are untested, add tests for them
- Do not remove existing tests unless they are truly obsolete

## Guidelines

- **Keep changes cohesive**: Each logical change should be related
- **Minimize scope**: Don't refactor code outside the areas specified
- **Preserve behavior**: Ensure the application works exactly as before
- **Clear diffs**: Structure changes to make code review easy
- **Test frequently**: Run tests after each significant change

## Success Criteria

- âœ… All existing tests pass
- âœ… Type checking passes with `mypy` or `pyright`
- âœ… Code is more readable with better structure
- âœ… No breaking changes to public APIs
- âœ… Documentation is up to date
