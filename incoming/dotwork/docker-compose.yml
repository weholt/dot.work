
# Solace - Simplified Docker Compose Configuration
#
# This compose file uses sensible defaults from the Dockerfile.
# Most environment variables are NOT needed here - they are already
# configured in the Dockerfile with production-ready values.
#
# When to use docker-compose vs docker run:
# - Use docker-compose when:
#   * You need to customize environment variables via .env file
#   * You're managing multiple containers together
#   * You want easier restart/update workflows
# - Use docker run when:
#   * You want quick testing with default config
#   * You only need a single Solace instance
#   * You prefer explicit command-line control
#
# Quick start (no .env file needed):
#   docker-compose up -d
#
# With custom configuration:
#   1. (Optional) Create .env file with your preferences
#   2. Docker Compose automatically loads .env if present
#   3. Run: docker-compose up -d
#
# See docs/ONE_COMMAND_DEPLOYMENT.md for detailed deployment guide

services:
  solace:
    build: .
    
    # Port mapping - customize here if you need different ports
    # Format: "HOST_PORT:CONTAINER_PORT"
    # Dockerfile defaults: 9765 (MCP server), 9766 (Web UI)
    # Environment variables from .env (if exists) or shell are automatically used
    ports:
      - "${PORT:-9765}:9765"      # MCP server port
      - "${WEB_PORT:-9766}:9766"  # Web UI port
    
    # Environment variable overrides (optional)
    # Uncomment and customize only if you need to override Dockerfile defaults
    # environment:
    #   - SOLACE_MODE=full               # Server mode: full (default), rag (API only), mcp (future)
    #   - MODEL_NAME=all-mpnet-base-v2   # Override embedding model
    #   - TEMPLATE_THEME=dark            # Override web UI theme
    #   - CORS_ORIGINS=*                 # CORS origins (comma-separated or * for all)
    
    # Volume mounts - customize data directory location
    # Dockerfile default: /data (recommended for production)
    # Change ${DATA_FOLDER:-./data} to your preferred host path
    # DATA_FOLDER from .env (if exists) or shell is automatically used
    volumes:
      - ${DATA_FOLDER:-./data}:/data    # Document storage + persistence
    
    # Restart policy - container auto-starts on boot
    restart: unless-stopped
    
    # Health check - verifies web UI is responding
    # Uses same healthcheck as defined in Dockerfile
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9766/view"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s